eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200   1) /* Siconos is a program dedicated to modeling, simulation and control
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300   2)  * of non smooth dynamical systems.
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300   3)  *
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200   4)  * Copyright 2016 INRIA.
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300   5)  *
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200   6)  * Licensed under the Apache License, Version 2.0 (the "License");
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200   7)  * you may not use this file except in compliance with the License.
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200   8)  * You may obtain a copy of the License at
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200   9)  *
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  10)  * http://www.apache.org/licenses/LICENSE-2.0
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  11)  *
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  12)  * Unless required by applicable law or agreed to in writing, software
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  13)  * distributed under the License is distributed on an "AS IS" BASIS,
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  14)  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  15)  * See the License for the specific language governing permissions and
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  16)  * limitations under the License.
eac4bf285f kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Maurice Bremond  2016-05-13 17:46:05 +0200  17) */
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  18)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  19) #include "D1MinusLinearOSI.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  20) #include "Simulation.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  21) #include "LagrangianLinearTIDS.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  22) #include "NewtonEulerDS.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  23) #include "LagrangianRheonomousR.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  24) #include "LagrangianScleronomousR.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  25) #include "NewtonEulerR.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  26) #include "NewtonImpactNSL.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  27) #include "BlockVector.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  28) #include "CxxStd.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  29) #include "Topology.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  30) #include "Model.hpp"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  31) #include "NonSmoothDynamicalSystem.hpp"
3cef5e883a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Olivier Huber    2015-01-31 22:54:05 +0100  32) #include "OneStepNSProblem.hpp"
3cef5e883a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Olivier Huber    2015-01-31 22:54:05 +0100  33)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100  34) // #define DEBUG_NOCOLOR
7bff292466 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 12:39:50 -0300  35) // #define DEBUG_STDOUT
7bff292466 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 12:39:50 -0300  36) // #define DEBUG_MESSAGES
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  37) #include "debug.h"
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  38)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300  39) #include <boost/make_shared.hpp>
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300  40)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  41) /// @cond
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  42) using namespace RELATION;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  43)
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300  44) /// for non-owned shared pointers
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300  45) static void null_deleter(const SiconosVector *) {}
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300  46)
81a5cd4a46 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-13 09:48:01 -0300  47) double D1MinusLinearOSI::computeResiduHalfExplicitAccelerationLevel()
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  48) {
7bff292466 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 12:39:50 -0300  49)   DEBUG_BEGIN("\n D1MinusLinearOSI::computeResiduHalfExplicitAccelerationLevel()\n");
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300  50)
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300  51)   double t = _simulation->nextTime(); // end of the time step
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300  52)   double told = _simulation->startingTime(); // beginning of the time step
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300  53)   double h = _simulation->timeStep(); // time step length
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300  54)   SP::OneStepNSProblems allOSNS  = _simulation->oneStepNSProblems(); // all OSNSP
0d14131c73 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-25 10:40:56 -0300  55)   SP::Topology topo =  _simulation->nonSmoothDynamicalSystem()->topology();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  56)   SP::InteractionsGraph indexSet2 = topo->indexSet(2);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  57)
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300  58)   /**************************************************************************************************************
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300  59)    *  Step 1-  solve a LCP at acceleration level for lambda^+_{k} for the last set indices
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300  60)    *   if index2 is empty we should skip this step
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300  61)    **************************************************************************************************************/
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300  62)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  63)   DEBUG_PRINT("\nEVALUATE LEFT HAND SIDE\n");
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  64)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  65)   DEBUG_EXPR(std::cout<< "allOSNS->empty()   " << std::boolalpha << allOSNS->empty() << std::endl << std::endl);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  66)   DEBUG_EXPR(std::cout<< "allOSNS->size()   "  << allOSNS->size() << std::endl << std::endl);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  67)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  68) // -- LEFT SIDE --
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100  69)
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300  70)   DynamicalSystemsGraph::VIterator dsi, dsend;
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100  71)   for(std11::tie(dsi, dsend) = _dynamicalSystemsGraph->vertices(); dsi != dsend; ++dsi)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  72)   {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100  73)     if(!checkOSI(dsi)) continue;
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300  74)     SP::DynamicalSystem ds = _dynamicalSystemsGraph->bundle(*dsi);
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300  75)     Type::Siconos dsType = Type::value(*ds);
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100  76)     VectorOfVectors& workVectors = *_dynamicalSystemsGraph->properties(*dsi).workVectors;
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200  77)     DEBUG_EXPR(ds->display());
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300  78)     SP::SiconosVector work_tdg;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  79)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100  80)     if((dsType == Type::LagrangianDS) || (dsType == Type::LagrangianLinearTIDS))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  81)     {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300  82)       SP::LagrangianDS d = std11::static_pointer_cast<LagrangianDS> (ds);
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100  83)       SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100  84)       /* POINTER CONSTRUCTOR : will contain the acceleration without contact force */
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100  85)       accFree.zero();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  86)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  87)       // get left state from memory
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300  88)       // (copy because computeForces takes non-const pointer)
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300  89)       SiconosVector qold = d->qMemory().getSiconosVector(0);
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300  90)       SiconosVector vold = d->velocityMemory().getSiconosVector(0); // right limit
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  91)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100  92)       DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  93)       DEBUG_EXPR(qold->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  94)       DEBUG_EXPR(vold->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300  95)
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100  96)       /* compute the force and store in accFree */
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300  97)       d->computeForces(told, qold.shared_from_this(), vold.shared_from_this());
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100  98)       DEBUG_EXPR(d->forces()->display());
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100  99)       accFree += *(d->forces());
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 100)
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 101)       /* Compute the acceleration due to the external force */
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 102)       /* accFree contains left (right limit) acceleration without contact force */
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 103)       if(d->inverseMass())
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 104) 	{
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 105) 	  d->update_inverse_mass();
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 106) 	  d->inverseMass()->PLUForwardBackwardInPlace(accFree);
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 107) 	}
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 108)
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 109)       /* Store the value of accFree in d->workspace(DynamicalSystem::free_tdg called work_tdg*/
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 110)       work_tdg =  workVectors[OneStepIntegrator::free_tdg];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 111)       work_tdg->zero();
d99a5771fc kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 02:53:31 +0100 112)       *work_tdg = accFree; // store the value in WorkFreeFree
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 113)
d99a5771fc kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 02:53:31 +0100 114)       //d->addWorkVector(accFree,DynamicalSystem::free_tdg); // store the value in WorkFreeFree
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 115)       DEBUG_PRINT("accFree contains right limit acceleration at  t^+_k with contact force :\n");
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 116)       DEBUG_EXPR(accFree.display());
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 117)       DEBUG_PRINT("work_tdg contains right limit acceleration at t^+_k without contact force :\n");
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 118)       DEBUG_EXPR(work_tdg->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 119)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 120)     else if(dsType == Type::NewtonEulerDS)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 121)     {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 122)       SP::NewtonEulerDS d = std11::static_pointer_cast<NewtonEulerDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 123)       SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 124)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 125)       // get left state from memory
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 126)       const SiconosVector& qold = d->qMemory().getSiconosVector(0);
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 127)       const SiconosVector& vold = d->twistMemory().getSiconosVector(0); // right limit
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300 128)       std11::shared_ptr<SiconosVector> pqold(&*(SiconosVector*)&qold, null_deleter);
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300 129)       std11::shared_ptr<SiconosVector> pvold(&*(SiconosVector*)&vold, null_deleter);
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 130)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 131)       DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 132)       DEBUG_EXPR(qold->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 133)       DEBUG_EXPR(vold->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 134)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 135)       work_tdg =  workVectors[OneStepIntegrator::free_tdg];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 136)       work_tdg->zero();
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 137)       DEBUG_EXPR(work_tdg->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 138)
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300 139)       d->computeForces(told, pqold, pvold);
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 140)       DEBUG_EXPR(d->forces()->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 141)
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 142)       accFree += *(d->forces());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 143)
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 144)       if(d->inverseMass())
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 145) 	{
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 146) 	  d->update_inverse_mass();
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 147) 	  d->inverseMass()->PLUForwardBackwardInPlace(accFree); // contains left (right limit) acceleration without contact force
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 148) 	}
d99a5771fc kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 02:53:31 +0100 149)       *work_tdg = accFree; // store the value in WorkFreeFree
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 150)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 151)       DEBUG_PRINT("accFree contains right limit acceleration at  t^+_k with contact force :\n");
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 152)       DEBUG_EXPR(accFree.display());
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 153)       DEBUG_PRINT("work_tdg contains right limit acceleration at t^+_k without contact force :\n");
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 154)       DEBUG_EXPR(work_tdg->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 155)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 156)     else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 157)     {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 158)       RuntimeException::selfThrow("D1MinusLinearOSI::computeResidu - not yet implemented for Dynamical system type: " + dsType);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 159)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 160)   }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 161)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 162)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 163)   if(!allOSNS->empty())
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 164)   {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 165)     if(indexSet2->size() >0)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 166)     {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 167)       InteractionsGraph::VIterator ui, uiend;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 168)       SP::Interaction inter;
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 169)       for(std11::tie(ui, uiend) = indexSet2->vertices(); ui != uiend; ++ui)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 170)       {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 171)         inter = indexSet2->bundle(*ui);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 172)         inter->relation()->computeJach(t, *inter, indexSet2->properties(*ui));
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 173)         inter->relation()->computeJacg(told, *inter, indexSet2->properties(*ui));
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 174)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 175)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 176)       if(_simulation->nonSmoothDynamicalSystem()->topology()->hasChanged())
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 177)       {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 178)         for(OSNSIterator itOsns = allOSNS->begin(); itOsns != allOSNS->end(); ++itOsns)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 179)         {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 180)           (*itOsns)->setHasBeenUpdated(false);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 181)         }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 182)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 183)       assert((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 184)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 185)       if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]->hasInteractions()))  // it should be equivalent to indexSet2
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 186)       {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 187)         DEBUG_PRINT("We compute lambda^+_{k} \n");
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 188)         (*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]->compute(told);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 189)         DEBUG_EXPR((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 190)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 191)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 192)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 193)       // Note Franck : at the time this results in a call to swapInMem of all Interactions of the NSDS
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 194)       // So let the simu do this.
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 195)       //(*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]->saveInMemory(); // we push y and lambda in Memories
0d14131c73 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-25 10:40:56 -0300 196)       _simulation->nonSmoothDynamicalSystem()->pushInteractionsInMemory();
0d14131c73 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-25 10:40:56 -0300 197)       _simulation->nonSmoothDynamicalSystem()->updateInput(_simulation->nextTime(),2);
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 198)
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 199)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 200)       for(std11::tie(dsi, dsend) = _dynamicalSystemsGraph->vertices(); dsi != dsend; ++dsi)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 201)       {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 202)         if(!checkOSI(dsi)) continue;
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 203)         SP::DynamicalSystem ds = _dynamicalSystemsGraph->bundle(*dsi);
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 204)
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 205)         Type::Siconos dsType = Type::value(*ds);
35eb2dc5de kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-02-01 15:04:26 +0100 206)         VectorOfVectors& workVectors = *_dynamicalSystemsGraph->properties(*dsi).workVectors;
35eb2dc5de kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-02-01 15:04:26 +0100 207)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 208)         if((dsType == Type::LagrangianDS) || (dsType == Type::LagrangianLinearTIDS))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 209)         {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 210)           SP::LagrangianDS d = std11::static_pointer_cast<LagrangianDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 211)           SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 212)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 213)           SP::SiconosVector dummy(new SiconosVector(*(d->p(2)))); // value = contact force
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 214)           if(d->inverseMass())
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 215)           {
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 216)             d->update_inverse_mass();
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 217)             d->inverseMass()->PLUForwardBackwardInPlace(*dummy);
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 218)           }
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 219)           accFree  += *(dummy);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 220)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 221)           DEBUG_EXPR(d->p(2)->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 222)         }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 223)         else if(dsType == Type::NewtonEulerDS)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 224)         {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 225)           SP::NewtonEulerDS d = std11::static_pointer_cast<NewtonEulerDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 226)           SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 227)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 228)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 229)           SP::SiconosVector dummy(new SiconosVector(*(d->p(2)))); // value = contact force
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 230)           if(d->inverseMass())
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 231)           {
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 232)             d->update_inverse_mass();
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 233)             d->inverseMass()->PLUForwardBackwardInPlace(*dummy);
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 234)           }
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 235)           accFree  += *(dummy);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 236)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 237)           DEBUG_EXPR(d->p(2)->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 238)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 239)         }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 240)         else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 241)           RuntimeException::selfThrow("D1MinusLinearOSI::computeResidu - not yet implemented for Dynamical system type: " + dsType);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 242)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 243)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 244)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 245)   }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 246)
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 247)   /**************************************************************************************************************
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 248)    *  Step 2 -  compute v_{k,1}
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 249)    **************************************************************************************************************/
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 250)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 251)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 252)   DEBUG_PRINT("\n PREDICT RIGHT HAND SIDE\n");
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 253)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 254)   for(std11::tie(dsi, dsend) = _dynamicalSystemsGraph->vertices(); dsi != dsend; ++dsi)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 255)   {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 256)     if(!checkOSI(dsi)) continue;
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 257)     SP::DynamicalSystem ds = _dynamicalSystemsGraph->bundle(*dsi);
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 258)     VectorOfVectors& workVectors = *_dynamicalSystemsGraph->properties(*dsi).workVectors;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 259)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 260)     // type of the current DS
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 261)     Type::Siconos dsType = Type::value(*ds);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 262)     /* \warning the following conditional statement should be removed with a MechanicalDS class */
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 263)     if((dsType == Type::LagrangianDS) || (dsType == Type::LagrangianLinearTIDS))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 264)     {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 265)       SP::LagrangianDS d = std11::static_pointer_cast<LagrangianDS> (ds);
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 266)       // contains residu without nonsmooth effect
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 267)       SiconosVector& residuFree = *workVectors[OneStepIntegrator::residu_free];
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 268)       SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 269)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 270)       // get left state from memory
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 271)       const SiconosVector& qold = d->qMemory().getSiconosVector(0);
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 272)       const SiconosVector& vold = d->velocityMemory().getSiconosVector(0);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 273)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 274)       // initialize *it->residuFree and predicted right velocity (left limit)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 275)       SiconosVector& v = *d->velocity(); //contains velocity v_{k+1}^- and not free velocity
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 276)       residuFree.zero();
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 277)       v.zero();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 278)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 279)       DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 280)       DEBUG_EXPR(qold->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 281)       DEBUG_EXPR(vold->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 282)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 283)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 284)       residuFree -= 0.5 * h*accFree;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 285)
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300 286)       v += h * accFree;
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 287)       v += vold;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 288)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 289)       DEBUG_EXPR(residuFree.display());
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 290)       DEBUG_EXPR(v.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 291)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 292)       SP::SiconosVector q = d->q(); // POINTER CONSTRUCTOR : contains position q_{k+1}
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 293)       *q = qold;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 294)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 295)       scal(0.5 * h, vold + v, *q, false);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 296)       DEBUG_EXPR(q->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 297)     }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 298)     else if(dsType == Type::NewtonEulerDS)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 299)     {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 300)       SP::NewtonEulerDS d = std11::static_pointer_cast<NewtonEulerDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 301)       SiconosVector& residuFree = *workVectors[OneStepIntegrator::residu_free];// contains residu without nonsmooth effect
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 302)       SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 303)       // get left state from memory
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 304)       const SiconosVector& qold = d->qMemory().getSiconosVector(0);
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 305)       const SiconosVector& vold = d->twistMemory().getSiconosVector(0);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 306)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 307)       // initialize *it->residuFree and predicted right velocity (left limit)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 308)       SiconosVector& v = *d->twist(); //contains velocity v_{k+1}^- and not free velocity
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 309)       residuFree.zero();
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 310)       v.zero();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 311)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 312)       DEBUG_EXPR(accFree.display());
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 313)       DEBUG_EXPR(qold.display());
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 314)       DEBUG_EXPR(vold.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 315)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 316)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 317)       residuFree -= 0.5 * h* accFree;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 318)
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300 319)       v += h * accFree;
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 320)       v += vold;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 321)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 322)       DEBUG_EXPR(residuFree.display());
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 323)       DEBUG_EXPR(v.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 324)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 325)       //first step consists in computing  \dot q.
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 326)       //second step consists in updating q.
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 327)       //
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 328)       SP::SiconosMatrix T = d->T();
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 329)       SiconosVector& dotq = *d->dotq();
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 330)       prod(*T, v, dotq, true);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 331)
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 332)       const SiconosVector& dotqold = d->dotqMemory().getSiconosVector(0);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 333)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 334)       SiconosVector& q = *d->q(); // POINTER CONSTRUCTOR : contains position q_{k+1}
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 335)       q = qold;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 336)
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 337)       scal(0.5 * h, dotqold + dotq, q, false);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 338)       DEBUG_PRINT("new q before normalizing\n");
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 339)       DEBUG_EXPR(q.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 340)       //q[3:6] must be normalized
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 341)       d->normalizeq();
297f39b1ac Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2015-06-09 12:42:02 -0300 342)       d->computeT();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 343)       DEBUG_PRINT("new q after normalizing\n");
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 344)       DEBUG_EXPR(q.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 345)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 346)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 347)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 348)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 349)     else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 350)       RuntimeException::selfThrow("D1MinusLinearOSI::computeResidu - not yet implemented for Dynamical system type: " + dsType);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 351)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 352)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 353)     /** At this step, we obtain
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 354)      * \f[
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 355)      * \begin{cases}
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 356)      * v_{k,0} = \mbox{\tt vold} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 357)      * q_{k,0} = qold \\
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 358)      * F_{k,+} = F(told,qold,vold) \\
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 359)      * Work_{freefree} =  M^{-1}_k (F^+_{k})  \mbox{stored in work_tdg} \\
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 360)      * Work_{free} =  M^{-1}_k (P^+_{2,k}+F^+_{k})  \mbox{stored in accFree} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 361)      * R_{free} = -h/2 * M^{-1}_k (P^+_{2,k}+F^+_{k})  \mbox{stored in ResiduFree} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 362)      * v_{k,1} = v_{k,0} + h * M^{-1}_k (P^+_{2,k}+F^+_{k})  \mbox{stored in v} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 363)      * q_{k,1} = q_{k,0} + \frac{h}{2} (v_{k,0} + v_{k,1}) \mbox{stored in q} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 364)      * \end{cases}
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 365)      * \f]
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 366)      **/
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 367)   }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 368)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 369)   DEBUG_PRINT("\n DECIDE STRATEGY\n");
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 370)   /** Decide of the strategy impact or smooth multiplier.
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 371)    *  Compute _isThereImpactInTheTimeStep
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 372)    */
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 373)   _isThereImpactInTheTimeStep = false;
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 374)   if(!allOSNS->empty())
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 375)   {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 376)
48d851d22b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-02-16 12:54:40 +0100 377)     for(unsigned int level = levelMinForOutput();
48d851d22b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-02-16 12:54:40 +0100 378)         level < levelMaxForOutput(); level++)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 379)     {
0d14131c73 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-25 10:40:56 -0300 380)       _simulation->nonSmoothDynamicalSystem()->updateOutput(_simulation->nextTime(),level);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 381)     }
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300 382)     _simulation->updateIndexSets();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 383)
0d14131c73 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-25 10:40:56 -0300 384)     SP::Topology topo =  _simulation->nonSmoothDynamicalSystem()->topology();
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 385)     SP::InteractionsGraph indexSet3 = topo->indexSet(3);
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 386)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 387)     if(indexSet3->size() > 0)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 388)     {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 389)       _isThereImpactInTheTimeStep = true;
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 390)       DEBUG_PRINT("There is an impact in the step. indexSet3->size() > 0. _isThereImpactInTheTimeStep = true;\n");
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 391)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 392)     else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 393)     {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 394)       _isThereImpactInTheTimeStep = false;
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 395)       DEBUG_PRINT("There is no  impact in the step. indexSet3->size() = 0. _isThereImpactInTheTimeStep = false;\n");
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 396)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 397)   }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 398)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 399)
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 400)   /* If _isThereImpactInTheTimeStep = true;
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 401)    * we recompute residuFree by removing the contribution of the nonimpulsive contact forces.
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 402)    * We add the contribution of the external forces at the end
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 403)    * of the time--step
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 404)    * If _isThereImpactInTheTimeStep = false;
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 405)    * we recompute residuFree by adding   the contribution of the external forces at the end
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 406)    * and the contribution of the nonimpulsive contact forces that are computed by solving the osnsp.
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 407)    */
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 408)   if(_isThereImpactInTheTimeStep)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 409)   {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 410)
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 411)     DEBUG_PRINT("There is an impact in the step. indexSet3->size() > 0.  _isThereImpactInTheTimeStep = true\n");
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 412)     for(std11::tie(dsi, dsend) = _dynamicalSystemsGraph->vertices(); dsi != dsend; ++dsi)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 413)     {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 414)       if(!checkOSI(dsi)) continue;
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 415)       SP::DynamicalSystem ds = _dynamicalSystemsGraph->bundle(*dsi);
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 416)       VectorOfVectors& workVectors = *_dynamicalSystemsGraph->properties(*dsi).workVectors;
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 417)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 418)       // type of the current DS
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 419)       Type::Siconos dsType = Type::value(*ds);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 420)       /* \warning the following conditional statement should be removed with a MechanicalDS class */
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 421)       if((dsType == Type::LagrangianDS) || (dsType == Type::LagrangianLinearTIDS))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 422)       {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 423)         SP::LagrangianDS d = std11::static_pointer_cast<LagrangianDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 424)         SiconosVector& residuFree = *workVectors[OneStepIntegrator::residu_free];
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 425)         SP::SiconosVector v = d->velocity();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 426)         SP::SiconosVector q = d->q();
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 427)         const SiconosVector& qold = d->qMemory().getSiconosVector(0);
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 428)         const SiconosVector& vold = d->velocityMemory().getSiconosVector(0); // right limit
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 429)         //residuFree.zero();
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 430)         //v->zero();
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 431)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 432)         SP::SiconosVector work_tdg = workVectors[OneStepIntegrator::free_tdg];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 433)         assert(work_tdg);
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 434)         residuFree =  - 0.5 * h* *work_tdg;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 435)
81527a8152 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 21:59:26 -0300 436)
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 437) 	d->computeForces(t, q, v);
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 438) 	*work_tdg = *(d->forces());
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 439) 	DEBUG_EXPR(d->forces()->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 440)
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 441) 	if(d->inverseMass())
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 442) 	  {
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 443) 	    d->update_inverse_mass();
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 444) 	    d->inverseMass()->PLUForwardBackwardInPlace(*work_tdg);
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 445) 	  }
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 446)         residuFree -= 0.5 * h**work_tdg;
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 447)         DEBUG_EXPR(residuFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 448)       }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 449)       else if(dsType == Type::NewtonEulerDS)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 450)       {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 451)         SP::NewtonEulerDS d = std11::static_pointer_cast<NewtonEulerDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 452)         SiconosVector& residuFree = *workVectors[OneStepIntegrator::residu_free];
41979d6f0b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-06 17:43:16 +0100 453)         SP::SiconosVector v = d->twist();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 454)         SP::SiconosVector q = d->q();
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 455)         const SiconosVector qold = d->qMemory().getSiconosVector(0);
8182a9fb3a kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-26 11:37:40 -0300 456)         const SiconosVector vold = d->twistMemory().getSiconosVector(0); // right limit
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 457)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 458)         //residuFree.zero();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 459)         v->zero();
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 460)         SP::SiconosVector work_tdg = workVectors[OneStepIntegrator::free_tdg];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 461)         assert(work_tdg);
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300 462)         residuFree = 0.5 * h * *work_tdg;
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 463)         work_tdg->zero();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 464)
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 465) 	d->computeForces(t, q, v);
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 466) 	*work_tdg += *(d->forces());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 467)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 468)
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 469) 	if(d->inverseMass())
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 470) 	  {
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 471) 	    d->update_inverse_mass();
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 472) 	    d->inverseMass()->PLUForwardBackwardInPlace(*work_tdg);
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 473) 	  }
d7bc28a1cd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-12-18 12:31:36 -0300 474)         residuFree -= 0.5 * h * *work_tdg;
f8abce61e2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Stephen Sinclair 2017-01-25 18:26:52 -0300 475)         DEBUG_EXPR(residuFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 476)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 477)       else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 478)         RuntimeException::selfThrow("D1MinusLinearOSI::computeResidu - not yet implemented for Dynamical system type: " + dsType);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 479)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 480)   }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 481)   else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 482)   {
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 483)     DEBUG_PRINT("There is no  impact in the step. indexSet3->size() = 0. _isThereImpactInTheTimeStep = false;\n");
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 484)     // -- RIGHT SIDE --
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 485)     // calculate acceleration without contact force
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 486)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 487)     for(std11::tie(dsi, dsend) = _dynamicalSystemsGraph->vertices(); dsi != dsend; ++dsi)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 488)     {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 489)       if(!checkOSI(dsi)) continue;
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 490)       SP::DynamicalSystem ds = _dynamicalSystemsGraph->bundle(*dsi);
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 491)       VectorOfVectors& workVectors = *_dynamicalSystemsGraph->properties(*dsi).workVectors;
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 492)
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 493)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 494)       // type of the current DS
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 495)       Type::Siconos dsType = Type::value(*ds);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 496)       /* \warning the following conditional statement should be removed with a MechanicalDS class */
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 497)       if((dsType == Type::LagrangianDS) || (dsType == Type::LagrangianLinearTIDS))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 498)       {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 499)
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 500)         SP::LagrangianDS d = std11::static_pointer_cast<LagrangianDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 501)         SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 502)         accFree.zero();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 503)         // get right state from memory
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 504)         SP::SiconosVector q = d->q(); // contains position q_{k+1}
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 505)         SP::SiconosVector v = d->velocity(); // contains velocity v_{k+1}^- and not free velocity
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 506)         DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 507)         DEBUG_EXPR(q->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 508)         DEBUG_EXPR(v->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 509)         // Lagrangian Nonlinear Systems
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 510)         if(dsType == Type::LagrangianDS || dsType == Type::LagrangianLinearTIDS)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 511)         {
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 512) 	  d->computeForces(t, q, v);
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 513) 	  accFree += *(d->forces());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 514)         }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 515)         else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 516)           RuntimeException::selfThrow
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 517)           ("D1MinusLinearOSI::computeResidu - not yet implemented for Dynamical system type: " + dsType);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 518)
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 519) 	if(d->inverseMass())
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 520) 	  {
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 521) 	    d->update_inverse_mass();
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 522) 	    d->inverseMass()->PLUForwardBackwardInPlace(accFree);// contains right (left limit) acceleration without contact force
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 523) 	  }
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 524) 	DEBUG_PRINT("accFree contains left limit acceleration at  t^-_{k+1} without contact force :\n");
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 525) 	DEBUG_EXPR(accFree.display());
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 526)       }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 527)       else if(dsType == Type::NewtonEulerDS)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 528)       {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 529)         SP::NewtonEulerDS d = std11::static_pointer_cast<NewtonEulerDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 530)         SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 531)
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 532)         accFree.zero();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 533)         // get right state from memory
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 534)         SP::SiconosVector q = d->q(); // contains position q_{k+1}
41979d6f0b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-06 17:43:16 +0100 535)         SP::SiconosVector v = d->twist(); // contains velocity v_{k+1}^- and not free velocity
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 536)         DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 537)         DEBUG_EXPR(q->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 538)         DEBUG_EXPR(v->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 539)
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 540) 	d->computeForces(t, q, v);
36508230b2 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-17 17:46:34 +0100 541) 	accFree += *(d->forces());
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 542)
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 543) 	if(d->inverseMass())
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 544) 	  {
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 545) 	    d->update_inverse_mass();
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 546) 	    d->inverseMass()->PLUForwardBackwardInPlace(accFree);// contains right (left limit) acceleration without contact force
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 547) 	  }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 548)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 549)         DEBUG_PRINT("accFree contains left limit acceleration at  t^-_{k+1} without contact force :\n");
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 550)         DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 551)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 552)       else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 553)         RuntimeException::selfThrow("D1MinusLinearOSI::computeResidu - not yet implemented for Dynamical system type: " + dsType);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 554)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 555)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 556)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 557)     // solve a LCP at acceleration level only for contacts which have been active at the beginning of the time-step
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 558)     if(!allOSNS->empty())
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 559)     {
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300 560)       // for (unsigned int level = _simulation->levelMinForOutput(); level < _simulation->levelMaxForOutput(); level++)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 561)       // {
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300 562)       //   _simulation->updateOutput(level);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 563)       // }
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300 564)       // _simulation->updateIndexSets();
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 565)       DEBUG_PRINT("We compute lambda^-_{k+1} \n");
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 566)       InteractionsGraph::VIterator ui, uiend;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 567)       SP::Interaction inter;
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 568)       for(std11::tie(ui, uiend) = indexSet2->vertices(); ui != uiend; ++ui)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 569)       {
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 570)         inter = indexSet2->bundle(*ui);
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 571)         inter->relation()->computeJach(t, *inter, indexSet2->properties(*ui));
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 572)         inter->relation()->computeJacg(t, *inter, indexSet2->properties(*ui));
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 573)       }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 574)       if(_simulation->nonSmoothDynamicalSystem()->topology()->hasChanged())
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 575)       {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 576)         for(OSNSIterator itOsns = allOSNS->begin(); itOsns != allOSNS->end(); ++itOsns)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 577)         {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 578)           (*itOsns)->setHasBeenUpdated(false);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 579)         }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 580)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 581)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 582)       if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]->hasInteractions()))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 583)       {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 584)         (*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]->compute(t);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 585)         DEBUG_EXPR((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]->display(););
0d14131c73 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-25 10:40:56 -0300 586)         _simulation->nonSmoothDynamicalSystem()->updateInput(_simulation->nextTime(),2);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 587)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 588)     }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 589)     for(std11::tie(dsi, dsend) = _dynamicalSystemsGraph->vertices(); dsi != dsend; ++dsi)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 590)     {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 591)       if(!checkOSI(dsi)) continue;
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 592)       SP::DynamicalSystem ds = _dynamicalSystemsGraph->bundle(*dsi);
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 593)       VectorOfVectors& workVectors = *_dynamicalSystemsGraph->properties(*dsi).workVectors;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 594)       // type of the current DS
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 595)       Type::Siconos dsType = Type::value(*ds);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 596)       /* \warning the following conditional statement should be removed with a MechanicalDS class */
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 597)       if((dsType == Type::LagrangianDS) || (dsType == Type::LagrangianLinearTIDS))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 598)       {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 599)         SP::LagrangianDS d = std11::static_pointer_cast<LagrangianDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 600)         SiconosVector& residuFree = *workVectors[OneStepIntegrator::residu_free];
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 601)         SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 602)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 603)         // initialize *it->residuFree
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 604)         residuFree -= 0.5 * h* accFree;
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 605)         DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 606)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 607)         if(d->p(2))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 608)         {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 609)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 610)           // get right state from memory
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 611)           DEBUG_EXPR(d->inverseMass()->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 612)           DEBUG_EXPR(d->p(2)->display());
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 613)           SiconosVector dummy(*(d->p(2))); // value = contact force
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 614)           if(d->inverseMass())
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 615)           {
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 616)             d->update_inverse_mass();
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 617)             d->inverseMass()->PLUForwardBackwardInPlace(dummy);
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 618)           }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 619)
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 620)           residuFree -= 0.5 * h*dummy;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 621)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 622)         }
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 623)         DEBUG_EXPR(residuFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 624)       }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 625)       else if(dsType == Type::NewtonEulerDS)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 626)       {
42f1feedc1 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-24 20:45:09 -0300 627)         SP::NewtonEulerDS d = std11::static_pointer_cast<NewtonEulerDS> (ds);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 628)         SiconosVector& residuFree = *workVectors[OneStepIntegrator::residu_free];
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 629)         SiconosVector& accFree = *workVectors[OneStepIntegrator::free];
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 630)         // initialize *it->residuFree
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 631)         residuFree -= 0.5 * h* accFree;
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 632)         DEBUG_EXPR(accFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 633)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 634)         if(d->p(2))
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 635)         {
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 636)           // get right state from memory
fd69e36b1b kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-05-16 11:46:43 +0200 637)           DEBUG_EXPR(d->inverseMass()->display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 638)           DEBUG_EXPR(d->p(2)->display());
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 639)           SiconosVector dummy(*(d->p(2))); // value = contact force
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 640) 	  if(d->inverseMass())
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 641) 	    {
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 642) 	      d->update_inverse_mass();
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 643) 	      d->inverseMass()->PLUForwardBackwardInPlace(dummy);
5a8f3d5054 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-06 11:13:05 +0100 644) 	    }
7120c857fd kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Franck Pérignon  2017-03-21 17:03:20 +0100 645)           residuFree -= 0.5 * h*dummy;
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 646)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 647)         }
ba20bbba46 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-27 10:00:08 +0100 648)         DEBUG_EXPR(residuFree.display());
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 649)       }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 650)       else
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 651)         RuntimeException::selfThrow("D1MinusLinearOSI::computeResidu - not yet implemented for Dynamical system type: " + dsType);
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 652)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 653)       /**
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 654)        * \f[
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 655)        * \begin{cases}
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 656)        * v_{k,0} = \mbox{vold} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 657)        * q_{k,0} = \mbox{qold} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 658)        * F^+_{k} = \mbox{F(told,qold,vold)} \\
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 659)        * v_{k,1} = v_{k,0} + h M^{-1}_k (P^+_{2,k}+F^+_{k}) \\[2mm]
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 660)        * q_{k,1} = q_{k,0} + \frac{h}{2} (v_{k,0} + v_{k,1})  \\[2mm]
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 661)        * F^-_{k+1} = F(t^{-}_{k+1},q_{k,1},v_{k,1}) \\[2mm]
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 662)        * R_{free} = - \frac{h}{2}  M^{-1}_k (P^+_{2,k}+F^+_{k}) -  \frac{h}{2}  M^{-1}_{k+1} (P^-_{2,k+1}+F^-_{k+1}) \\[2mm]
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 663)        * \end{cases}
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 664)        * \f]
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 665)        **/
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 666)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 667)     }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 668)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 669)   } // No impact
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 670)
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 671)
7bff292466 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 12:39:50 -0300 672)   DEBUG_END("D1MinusLinearOSI::computeResiduHalfExplicitAccelerationLevel()\n");
8a48be18a5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-14 18:35:16 -0300 673)
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 674)   return 0.; // there is no Newton iteration and the residuum is assumed to vanish
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 675) }
e560e663c0 Kernel/src/simulationTools/D1MinusLinearOSIExplicitAccelerationLevelOSI.cpp     (Vincent Acary    2014-09-12 16:34:48 -0300 676)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 677)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 678) void D1MinusLinearOSI::computeFreeOutputHalfExplicitAccelerationLevel(InteractionsGraph::VDescriptor& vertex_inter, OneStepNSProblem* osnsp)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 679) {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 680)
7bff292466 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 12:39:50 -0300 681)   DEBUG_BEGIN("D1MinusLinearOSI::computeFreeOutputHalfExplicitAccelerationLevel\n");
3d1c3c3c21 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 09:16:46 -0300 682)   SP::OneStepNSProblems allOSNS  = _simulation->oneStepNSProblems(); // all OSNSP
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 683)   SP::InteractionsGraph indexSet = osnsp->simulation()->indexSet(osnsp->indexSetLevel());
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 684)   SP::Interaction inter = indexSet->bundle(vertex_inter);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 685)   VectorOfBlockVectors& DSlink = *indexSet->properties(vertex_inter).DSlink;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 686)   // get relation and non smooth law information
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 687)   RELATION::TYPES relationType = inter->relation()->getType(); // relation
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 688)   RELATION::SUBTYPES relationSubType = inter->relation()->getSubType();
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 689)   unsigned int relativePosition = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 690)   unsigned int sizeY = inter->nonSmoothLaw()->size(); // related NSL
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 691)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 692)   Index coord(8);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 693)   coord[0] = relativePosition;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 694)   coord[1] = relativePosition + sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 695)   coord[2] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 696)   coord[3] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 697)   coord[4] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 698)   coord[5] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 699)   coord[6] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 700)   coord[7] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 701)   SP::SiconosMatrix C; // Jacobian of Relation with respect to degree of freedom
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 702)   SP::BlockVector Xfree; // free degree of freedom
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 703)
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 704)   SiconosVector& osnsp_rhs = *(*indexSet->properties(vertex_inter).workVectors)[D1MinusLinearOSI::OSNSP_RHS];
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 705)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 706)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 707)   // define Xfree for velocity and acceleration level
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 708)   if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY]).get() == osnsp)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 709)   {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 710)     //Xfree = inter->dataX();
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 711)     /* get the current velocity  of the aggregated ds */
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 712)     if(relationType == Lagrangian)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 713)     {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 714)       Xfree = DSlink[LagrangianR::q1];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 715)       DEBUG_PRINT("Xfree = DSlink[LagrangianR::q1];\n");
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 716)     }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 717)     else if(relationType == NewtonEuler)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 718)     {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 719)       Xfree = DSlink[NewtonEulerR::velocity];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 720)       DEBUG_PRINT("Xfree = DSlink[LagrangianR::veclocity];\n");
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 721)     }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 722)     else
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 723)       RuntimeException::selfThrow("D1MinusLinearOSI::computeFreeOutput - unknown relation type.");
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 724)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 725)     DEBUG_EXPR(Xfree->display());
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 726)     assert(Xfree);
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 727)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 728)   }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 729)   else if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]).get() == osnsp)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 730)   {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 731)     /* get the "free" acceleration of the aggregated ds */
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 732)     if(relationType == Lagrangian)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 733)     {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 734)       Xfree = DSlink[LagrangianR::xfree];
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 735)     }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 736)     else if(relationType == NewtonEuler)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 737)     {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 738)       Xfree = DSlink[NewtonEulerR::xfree];
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 739)     }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 740)     else
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 741)       RuntimeException::selfThrow("D1MinusLinearOSI::computeFreeOutput - unknown relation type.");
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 742)     DEBUG_PRINT("Xfree = DSlink[LagrangianR::xfree];\n");
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 743)     DEBUG_EXPR(Xfree->display());
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 744)     assert(Xfree);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 745)   }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 746)   else
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 747)     RuntimeException::selfThrow("D1MinusLinearOSI::computeFreeOutput - OSNSP neither on velocity nor on acceleration level.");
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 748)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 749)   // calculate data of interaction
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 750)   SP::Interaction mainInteraction = inter;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 751)   assert(mainInteraction);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 752)   assert(mainInteraction->relation());
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 753)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 754)   // only Lagrangian Systems
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 755)   if(relationType == Lagrangian)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 756)   {
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 757)     // in osnsp_rhs the linear part of velocity or acceleration relation will be saved
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 758)     C = std11::static_pointer_cast<LagrangianR>(mainInteraction->relation())->C();
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 759)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 760)     if(C)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 761)     {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 762)       assert(Xfree);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 763)       coord[3] = C->size(1);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 764)       coord[5] = C->size(1);
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 765)       subprod(*C, *Xfree, osnsp_rhs, coord, true);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 766)     }
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 767)     DEBUG_EXPR(osnsp_rhs.display(););
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 768)
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 769)     // in osnsp_rhs corrections have to be added
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 770)     SP::SiconosMatrix ID(new SimpleMatrix(sizeY, sizeY));
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 771)     ID->eye();
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 772)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 773)     Index xcoord(8);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 774)     xcoord[0] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 775)     xcoord[1] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 776)     xcoord[2] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 777)     xcoord[3] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 778)     xcoord[4] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 779)     xcoord[5] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 780)     xcoord[6] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 781)     xcoord[7] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 782)
239b5535c1 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-25 07:28:35 -0300 783)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 784)     if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY]).get() == osnsp)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 785)     {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 786)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 787)       /*  explicit time dependence -> partial time derivative has to be added */
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 788)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 789)       // if (relationSubType == RheonomousR) // explicit time dependence -> partial time derivative has to be added
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 790)       // {
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 791)       //   SiconosVector q = *DSlink[LagrangianR::q0];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 792)       //   SiconosVector z = *DSlink[LagrangianR::z];
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 793)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 794)       //   std11::static_pointer_cast<LagrangianRheonomousR>(inter->relation())->computehDot(simulation()->getTkp1(), q, z);
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 795)       //   *DSlink[LagrangianR::z] = z;
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 796)       //   subprod(*ID, *(std11::static_pointer_cast<LagrangianRheonomousR>(inter->relation())->hDot()), osnsp_rhs, xcoord, false);
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 797)       // }
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 798)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 799)       if(relationSubType == RheonomousR)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 800)         RuntimeException::selfThrow("D1MinusLinearOSI::computeFreeOutput is not implemented  at velocity level for LagrangianRheonomousR.");
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 801)       SP::SiconosVisitor nslEffectOnFreeOutput(new _NSLEffectOnFreeOutput(osnsp, inter, indexSet->properties(vertex_inter)));
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 802)       inter->nonSmoothLaw()->accept(*nslEffectOnFreeOutput);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 803)     }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 804)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 805)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 806)     if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]).get() == osnsp)
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 807)     {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 808)       if(relationSubType == ScleronomousR)  // acceleration term involving Hessian matrix of Relation with respect to degree is added
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 809)       {
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 810)         DEBUG_PRINT("D1MinusLinearOSI::computeFreeOutput. acceleration term involving Hessian matrix of Relation\n");
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 811)         DEBUG_EXPR(osnsp_rhs.display(););
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 812)         std11::static_pointer_cast<LagrangianScleronomousR>(inter->relation())->computedotjacqhXqdot(simulation()->getTkp1(), *inter, DSlink);
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 813)         subprod(*ID, *(std11::static_pointer_cast<LagrangianScleronomousR>(inter->relation())->dotjacqhXqdot()), osnsp_rhs, xcoord, false);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 814)       }
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 815)       DEBUG_EXPR(osnsp_rhs.display(););
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 816)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 817)     }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 818)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 819)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 820)   }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 821)   else if(relationType == NewtonEuler)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 822)   {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 823)     SP::SiconosMatrix CT =  std11::static_pointer_cast<NewtonEulerR>(mainInteraction->relation())->jachqT();
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 824)     DEBUG_EXPR(CT->display());
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 825)     if(CT)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 826)     {
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 827)       coord[3] = CT->size(1);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 828)       coord[5] = CT->size(1);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 829)       assert(Xfree);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 830)       // creates a POINTER link between workX[ds] (xfree) and the
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 831)       // corresponding interactionBlock in each Interaction for each ds of the
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 832)       // current Interaction.
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 833)       // XXX Big quirks !!! -- xhub
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 834)       subprod(*CT, *Xfree, osnsp_rhs, coord, true);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 835)     }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 836)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 837)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 838)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 839)     if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY + 1]).get() == osnsp)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 840)     {
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 841)       // in osnsp_rhs corrections have to be added
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 842)       SP::SiconosMatrix ID(new SimpleMatrix(sizeY, sizeY));
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 843)       ID->eye();
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 844)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 845)       Index xcoord(8);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 846)       xcoord[0] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 847)       xcoord[1] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 848)       xcoord[2] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 849)       xcoord[3] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 850)       xcoord[4] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 851)       xcoord[5] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 852)       xcoord[6] = 0;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 853)       xcoord[7] = sizeY;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 854)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 855)       DEBUG_PRINT("D1MinusLinearOSI::computeFreeOutput.\n Adding the additional terms of the second order time derivative of constraints.\n");
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 856)       DEBUG_EXPR(osnsp_rhs.display(););
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 857)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 858)       /** Compute additional terms of the second order time derivative of constraints
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 859)        *
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 860)        * \f$ \nabla_q h(q) \dot T v + \frac{d}{dt}(\nabla_q h(q) ) T v \f$
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 861)        *
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 862)        */
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 863)       SP::DynamicalSystem ds1 = indexSet->properties(vertex_inter).source;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 864)       SP::DynamicalSystem ds2 = indexSet->properties(vertex_inter).target;
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 865)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 866)       std11::static_pointer_cast<NewtonEulerR>(inter->relation())->computeSecondOrderTimeDerivativeTerms(simulation()->getTkp1(), *inter, DSlink, ds1, ds2);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 867)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 868)       DEBUG_EXPR((std11::static_pointer_cast<NewtonEulerR>(inter->relation())->secondOrderTimeDerivativeTerms())->display());
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 869)
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 870)       subprod(*ID, *(std11::static_pointer_cast<NewtonEulerR>(inter->relation())->secondOrderTimeDerivativeTerms()), osnsp_rhs, xcoord, false);
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 871)       DEBUG_EXPR(osnsp_rhs.display(););
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 872)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 873)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 874)     }
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 875)     DEBUG_EXPR(osnsp_rhs.display(););
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 876)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 877)     if(((*allOSNS)[SICONOS_OSNSP_TS_VELOCITY]).get() == osnsp)  // impact terms are added
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 878)     {
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 879)       SP::SiconosVisitor nslEffectOnFreeOutput(new _NSLEffectOnFreeOutput(osnsp, inter, indexSet->properties(vertex_inter)));
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 880)       inter->nonSmoothLaw()->accept(*nslEffectOnFreeOutput);
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 881)     }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 882)   }
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 883)   else
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 884)     RuntimeException::selfThrow("D1MinusLinearOSI::computeFreeOutput - not implemented for Relation of type " + relationType);
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 885)
ab43cf47cf kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-06-05 20:03:37 +0200 886)   DEBUG_EXPR(osnsp_rhs.display(););
7bff292466 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2016-04-21 12:39:50 -0300 887)   DEBUG_END("D1MinusLinearOSI::computeFreeOutputHalfExplicitAccelerationLevel ends\n");
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 888)
af33d0c370 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-16 08:50:24 -0300 889) }
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 890)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 891)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 892) bool D1MinusLinearOSI::addInteractionInIndexSetHalfExplicitAccelerationLevel(SP::Interaction inter, unsigned int i)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 893) {
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 894)   DEBUG_PRINT("D1MinusLinearOSI::addInteractionInIndexSetHalfExplicitAccelerationLevel.\n");
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 895)
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 896)   if(i == 1)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 897)   {
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 898)     DEBUG_PRINT(" level == 1\n");
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 899)     if(Type::value(*(inter->nonSmoothLaw())) == Type::EqualityConditionNSL)
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 900)     {
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 901)       return true;
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 902)     }
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 903)     /* Active for impulses calculations? Contacts that are closed */
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 904)     double y = (*(inter->y(0)))(0); // current position
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 905)     DEBUG_PRINTF("y= %24.16e\n", y);
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 906)     return (y <= DEFAULT_TOL_D1MINUS);
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 907)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 908)   }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 909)   else if(i == 2)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 910)   {
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 911)     DEBUG_PRINT(" level == 2\n");
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 912)     if(Type::value(*(inter->nonSmoothLaw())) == Type::EqualityConditionNSL)
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 913)     {
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 914)       return true;
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 915)     }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 916)     /* Active for non-impulsive forces computation */
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 917)     double y = (*(inter->y(0)))(0); // current position
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 918)     double yDot = (*(inter->y(1)))(0); // current position
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 919)     DEBUG_PRINTF("y= %24.16e\n", y);
0b7857b14f Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-10-06 12:55:51 -0300 920)     DEBUG_PRINTF("yDot= %24.16e\n", yDot);
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 921)     DEBUG_EXPR(std::cout << std::boolalpha << (y <= DEFAULT_TOL_D1MINUS) <<std::endl;);
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 922)     DEBUG_EXPR(std::cout << std::boolalpha << (yDot <= DEFAULT_TOL_D1MINUS) <<std::endl;);
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 923)     return (y <= DEFAULT_TOL_D1MINUS) && (yDot <= DEFAULT_TOL_D1MINUS);
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 924)   }
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 925)   else if(i == 3)
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 926)   {
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 927)     if(Type::value(*(inter->nonSmoothLaw())) == Type::EqualityConditionNSL)
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 928)     {
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 929)       return false;
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 930)     }
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 931)     /*  Contacts which have been closing in the last time step */
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 932)     DEBUG_PRINT(" level == 3\n");
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 933)     double y = (*(inter->y(0)))(0); // current position
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 934)     double yOld = (*(inter->yOld(0)))(0); // old position
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 935)     DEBUG_PRINTF("y= %24.16e\n", y);
d1bcb3cab0 kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2017-01-30 14:18:17 +0100 936)     DEBUG_PRINTF("yOld= %24.16e\n", yOld);
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 937)     /* if Interaction has not been active in the previous calculation
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 938)        and now becomes active */
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 939)     return (y <= DEFAULT_TOL_D1MINUS && yOld > DEFAULT_TOL_D1MINUS);
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 940)   }
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 941)   else
3479c1d4d5 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 15:31:21 -0300 942)     RuntimeException::selfThrow("D1MinusLinearOSI::addInteractionInIndexSetHalfExplicitAccelerationLevel, IndexSet[i > 3] does not exist.");
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 943)   return false;
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 944) }
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 945)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 946) bool D1MinusLinearOSI::removeInteractionInIndexSetHalfExplicitAccelerationLevel(SP::Interaction inter, unsigned int i)
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 947) {
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 948)   DEBUG_PRINT("D1MinusLinearOSI::removeInteractionInIndexSetHalfExplicitAccelerationLevel.\n");
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 949)
c776470e32 Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-21 20:36:44 -0300 950)   return !(addInteractionInIndexSetHalfExplicitAccelerationLevel(inter,i));
a3ce9f548a Kernel/src/simulationTools/D1MinusLinearOSIHalfExplicitAccelerationLevelOSI.cpp (Vincent Acary    2014-09-20 21:30:28 -0300 951) }
