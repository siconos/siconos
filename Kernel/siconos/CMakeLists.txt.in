# -*- cmake -*-

SET(CMAKE_MODULE_PATH @CMAKE_INSTALL_PREFIX@/share/siconos-kernel/cmake)

INCLUDE(CMakeImportBuildSettings)
CMAKE_IMPORT_BUILD_SETTINGS(BuildSettings)
INCLUDE(LibraryDependencies)
INCLUDE(Settings)

FOREACH(_DEF ${ALL_EXTRA_DEFINITIONS})
  IF(DEFINED ${_DEF})
    ADD_DEFINITIONS(-D${_DEF}=${${_DEF}})
  ELSE(DEFINED ${_DEF})
    ADD_DEFINITIONS(-D${_DEF})
  ENDIF(DEFINED ${_DEF})
ENDFOREACH(_DEF ${ALL_EXTRA_DEFINITIONS})

IF(MAIN_SOURCE)
  GET_FILENAME_COMPONENT(_EXE ${MAIN_SOURCE} NAME_WE)
ENDIF(MAIN_SOURCE)


IF(_EXE)

  #
  # include and lib directories, before target definition
  #

  IF(WithQGLViewer)
    FIND_PACKAGE(Qt4 REQUIRED)
    FIND_PACKAGE(QGLViewer REQUIRED)
    FIND_PACKAGE(OpenGL REQUIRED)
    INCLUDE_DIRECTORIES(${QT_INCLUDES})
    INCLUDE_DIRECTORIES(${QGLVIEWER_INCLUDE_DIR})
    INCLUDE_DIRECTORIES(${OPENGL_INCLUDE_DIR})
    ADD_DEFINITIONS(${QT_DEFINITIONS})
    ADD_DEFINITIONS(${QGLVIEWER_DEFINITIONS})
  ENDIF(WithQGLViewer)
  
  FOREACH(_D ${PROJECT_INCLUDE_DIRECTORIES})
    INCLUDE_DIRECTORIES(${_D})
  ENDFOREACH(_D ${PROJECT_INCLUDE_DIRECTORIES})
  
  FOREACH(_D ${PROJECT_LINK_DIRECTORIES})
    LINK_DIRECTORIES(${_D})
  ENDFOREACH(_D ${PROJECT_LINK_DIRECTORIES})
 
  
  FOREACH(_D ${PROJECT_FORTRAN_COMPILER_LIB_DIRECTORIES})
    LINK_DIRECTORIES(${_D})
  ENDFOREACH(_D ${PROJECT_FORTRAN_COMPILER_LIB_DIRECTORIES})


  #
  # target definition
  #
  IF(SOURCES_DIRECTORY)
    FILE(GLOB _ALL_SRCS ${SOURCES_DIRECTORY}/*.c ${SOURCES_DIRECTORY}/*.cpp ${SOURCES_DIRECTORY}/*.f)
    FOREACH(_SRC ${_ALL_SRCS})
      IF(${_SRC} MATCHES .*Plugin.cpp)
      ELSE(${_SRC} MATCHES .*Plugin.cpp)
        LIST(APPEND _ALL_EXE_SRCS ${_SRC})
      ENDIF(${_SRC} MATCHES .*Plugin.cpp)
    ENDFOREACH(_SRC ${_ALL_SRCS})
    ADD_EXECUTABLE(${_EXE} ${_ALL_EXE_SRCS})
  ELSE(SOURCES_DIRECTORY)
    IF(_EXE)
      ADD_EXECUTABLE(${_EXE} ${MAIN_SOURCE})  
    ENDIF(_EXE)
  ENDIF(SOURCES_DIRECTORY)
  

  #
  # final link
  #

  FOREACH(_L ${PROJECT_LINK_LIBRARIES})
    TARGET_LINK_LIBRARIES(${_EXE} ${_L})
  ENDFOREACH(_L ${PROJECT_LINK_LIBRARIES})
  
  FOREACH(_L ${PROJECT_FORTRAN_LIBRARIES})
    TARGET_LINK_LIBRARIES(${_EXE} ${_L})
  ENDFOREACH(_L ${PROJECT_FORTRAN_LIBRARIES})
  
  IF(WithQGLViewer)
    TARGET_LINK_LIBRARIES(${_EXE} ${QGLVIEWER_LIBRARY})
    TARGET_LINK_LIBRARIES(${_EXE} ${QT_QTXML_LIBRARY})
    TARGET_LINK_LIBRARIES(${_EXE} ${QT_QTCORE_LIBRARY})
    TARGET_LINK_LIBRARIES(${_EXE} ${QT_QTASSISTANT_LIBRARY})
    TARGET_LINK_LIBRARIES(${_EXE} ${QT_QTGUI_LIBRARY})
    TARGET_LINK_LIBRARIES(${_EXE} ${OPENGL_gl_LIBRARY})
    TARGET_LINK_LIBRARIES(${_EXE} ${OPENGL_glu_LIBRARY})
  ENDIF(WithQGLViewer)

  #
  # Plugins 
  # 
  IF(EXISTS ${_EXE}Plugin.cpp)
    ADD_LIBRARY(${_EXE}Plugin MODULE ./${_EXE}Plugin.cpp)
    SET_TARGET_PROPERTIES(${_EXE}Plugin  PROPERTIES PREFIX "")
  ENDIF(EXISTS ${_EXE}Plugin.cpp)
  
  IF(PLUGIN_SOURCE)
    IF(EXISTS ${PLUGIN_SOURCE})
      GET_FILENAME_COMPONENT(_PLUGIN ${PLUGIN_SOURCE} NAME_WE)
      ADD_LIBRARY(${_PLUGIN} MODULE ${PLUGIN_SOURCE})
      SET_TARGET_PROPERTIES(${_PLUGIN}  PROPERTIES PREFIX "")
    ENDIF(EXISTS ${PLUGIN_SOURCE})
  ENDIF(PLUGIN_SOURCE)

ENDIF(_EXE)
